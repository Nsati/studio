{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Uttarakhand Getaways application.",
      "properties": {
        "uid": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The user's role (e.g., user, admin)."
        }
      },
      "required": [
        "uid",
        "name",
        "email",
        "role"
      ]
    },
    "Hotel": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Hotel",
      "type": "object",
      "description": "Represents a hotel in Uttarakhand.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the hotel."
        },
        "name": {
          "type": "string",
          "description": "The name of the hotel."
        },
        "city": {
          "type": "string",
          "description": "The city where the hotel is located."
        },
        "description": {
          "type": "string",
          "description": "A description of the hotel."
        },
        "images": {
          "type": "array",
          "description": "An array of image URLs for the hotel.",
          "items": {
            "type": "string"
          }
        },
        "amenities": {
          "type": "array",
          "description": "An array of amenities offered by the hotel.",
          "items": {
            "type": "string"
          }
        },
        "rating": {
          "type": "number",
          "description": "The rating of the hotel."
        }
      },
      "required": [
        "id",
        "name",
        "city",
        "description",
        "images",
        "amenities",
        "rating"
      ]
    },
    "Room": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Room",
      "type": "object",
      "description": "Represents a room type within a hotel.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the room."
        },
        "hotelId": {
          "type": "string",
          "description": "Reference to the Hotel. (Relationship: Hotel 1:N Room)"
        },
        "type": {
          "type": "string",
          "description": "The type of room (e.g., Deluxe, Suite)."
        },
        "price": {
          "type": "number",
          "description": "The price per night for the room."
        },
        "capacity": {
          "type": "number",
          "description": "The maximum capacity of the room."
        },
        "totalRooms": {
          "type": "number",
          "description": "The total number of rooms of this type available in the hotel."
        }
      },
      "required": [
        "id",
        "hotelId",
        "type",
        "price",
        "capacity",
        "totalRooms"
      ]
    },
    "Booking": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Booking",
      "type": "object",
      "description": "Represents a booking made by a user for a specific room.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the booking."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User. (Relationship: User 1:N Booking)"
        },
        "roomId": {
          "type": "string",
          "description": "Reference to the Room. (Relationship: Room 1:N Booking)"
        },
        "checkIn": {
          "type": "string",
          "description": "The check-in date for the booking.",
          "format": "date-time"
        },
        "checkOut": {
          "type": "string",
          "description": "The check-out date for the booking.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The status of the booking (e.g., locked, confirmed, cancelled)."
        },
        "expiresAt": {
          "type": "string",
          "description": "The expiration timestamp for the booking (used for locking).",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "roomId",
        "checkIn",
        "checkOut",
        "status",
        "expiresAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  The 'userId' parameter is the Firebase Authentication UID. Ensures path-based ownership for user-specific data. Includes fields 'uid', 'name', 'email', and 'role'.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, matching the Firebase Authentication UID."
            }
          ]
        }
      },
      {
        "path": "/hotels/{hotelId}",
        "definition": {
          "entityName": "Hotel",
          "schema": {
            "$ref": "#/backend/entities/Hotel"
          },
          "description": "Stores hotel information. Includes fields 'id', 'name', 'city', 'description', 'images', 'amenities', and 'rating'.",
          "params": [
            {
              "name": "hotelId",
              "description": "The unique identifier for the hotel."
            }
          ]
        }
      },
      {
        "path": "/hotels/{hotelId}/rooms/{roomId}",
        "definition": {
          "entityName": "Room",
          "schema": {
            "$ref": "#/backend/entities/Room"
          },
          "description": "Stores room information for each hotel. Includes fields 'id', 'hotelId', 'type', 'price', 'capacity', and 'totalRooms'.",
          "params": [
            {
              "name": "hotelId",
              "description": "The unique identifier for the hotel."
            },
            {
              "name": "roomId",
              "description": "The unique identifier for the room."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/bookings/{bookingId}",
        "definition": {
          "entityName": "Booking",
          "schema": {
            "$ref": "#/backend/entities/Booking"
          },
          "description": "Stores booking information for each user. Includes fields 'id', 'userId', 'roomId', 'checkIn', 'checkOut', 'status', and 'expiresAt'. This structure enforces ownership; only the user with the matching 'userId' can access bookings under this path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user who made the booking."
            },
            {
              "name": "bookingId",
              "description": "The unique identifier for the booking."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{uid}",
        "definition": {
          "entityName": "AdminRole",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection to store admin roles.  The existence of a document with a specific UID in this collection grants admin privileges to that user. Existence over content is preferred for rule simplicity.",
          "params": [
            {
              "name": "uid",
              "description": "The unique identifier for the admin user, matching the Firebase Authentication UID."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to handle the Uttarakhand Getaways hotel booking application, focusing on security, scalability, and real-time updates. It leverages denormalization for authorization independence and structural segregation to simplify security rules.\n\n**Authorization Independence (CRITICAL):**\n*   The design avoids `get()` calls in security rules by denormalizing authorization context. For example, the `bookings` subcollection under `/users/{userId}` inherently grants the user access to their own bookings.\n*   Admin roles are managed using the `/roles_admin/{uid}` collection. The existence of a document in this collection grants admin privileges.\n\n**Structural Segregation:**\n*   User-specific data (bookings) is stored under `/users/{userId}`, ensuring that each user can only access their own data.\n*   Hotel and room data are stored in separate collections (`/hotels` and `/hotels/{hotelId}/rooms`) to facilitate efficient querying and management.\n\n**Access Modeling:**\n*   Path-based ownership is used for private user data (bookings under `/users/{userId}`).\n*   The membership map approach is not explicitly needed, as no collaborative access to individual documents is specified in the requirements.\n*   Global admin roles are managed using the dedicated `/roles_admin/{uid}` collection, checking for document existence to grant admin privileges.\n\n**QAPs (Rules are not Filters):**\n*   Secure `list` operations are supported by segregating data based on access needs. For example, listing bookings is secure because the bookings are stored under the user's ID (`/users/{userId}/bookings`).\n\n**Invariants:**\n*   Ownership is enforced by the path structure (e.g., `/users/{userId}/bookings/{bookingId}` ensures that only the user can access their bookings).\n*   Timestamps (e.g., `checkIn`, `checkOut`, `expiresAt`) are directly stored in the `Booking` document, allowing for easy querying and filtering based on time ranges.\n*   Data integrity is maintained by Firestore transactions and security rules that prevent unauthorized modifications.\n\nThe proposed structure aligns with the core design principles, ensuring a secure, scalable, and maintainable Firestore database for the Uttarakhand Getaways application."
  }
}