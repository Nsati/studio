{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Uttarakhand Getaways application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The user's role within the application (e.g., 'user', 'admin')."
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "role"
      ]
    },
    "Hotel": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Hotel",
      "type": "object",
      "description": "Represents a hotel in the Uttarakhand Getaways application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the hotel entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the hotel."
        },
        "city": {
          "type": "string",
          "description": "The city where the hotel is located."
        },
        "description": {
          "type": "string",
          "description": "A description of the hotel."
        },
        "images": {
          "type": "array",
          "description": "An array of image URLs for the hotel.",
          "items": {
            "type": "string"
          }
        },
        "amenities": {
          "type": "array",
          "description": "An array of amenities offered by the hotel.",
          "items": {
            "type": "string"
          }
        },
        "rating": {
          "type": "number",
          "description": "The hotel's rating."
        }
      },
      "required": [
        "id",
        "name",
        "city",
        "description",
        "images",
        "amenities",
        "rating"
      ]
    },
    "Room": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Room",
      "type": "object",
      "description": "Represents a room in a hotel.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the room entity."
        },
        "hotelId": {
          "type": "string",
          "description": "Reference to Hotel. (Relationship: Hotel 1:N Room)"
        },
        "type": {
          "type": "string",
          "description": "The type of room (e.g., 'Single', 'Double', 'Suite')."
        },
        "price": {
          "type": "number",
          "description": "The price per night for the room."
        },
        "capacity": {
          "type": "number",
          "description": "The maximum capacity of the room."
        },
        "totalRooms": {
          "type": "number",
          "description": "The total number of rooms of this type in the hotel."
        }
      },
      "required": [
        "id",
        "hotelId",
        "type",
        "price",
        "capacity",
        "totalRooms"
      ]
    },
    "Booking": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Booking",
      "type": "object",
      "description": "Represents a booking made by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the booking entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Booking)"
        },
        "roomId": {
          "type": "string",
          "description": "Reference to Room. (Relationship: Room 1:N Booking)"
        },
        "checkIn": {
          "type": "string",
          "description": "The check-in date for the booking.",
          "format": "date-time"
        },
        "checkOut": {
          "type": "string",
          "description": "The check-out date for the booking.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The status of the booking (e.g., 'locked', 'confirmed', 'cancelled')."
        },
        "expiresAt": {
          "type": "string",
          "description": "The expiration date and time for the booking (used for locking).",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "roomId",
        "checkIn",
        "checkOut",
        "status",
        "expiresAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Uses path-based ownership for private user data. Each user has a single document in this collection.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/hotels/{hotelId}",
        "definition": {
          "entityName": "Hotel",
          "schema": {
            "$ref": "#/backend/entities/Hotel"
          },
          "description": "Stores hotel information. Publicly readable.",
          "params": [
            {
              "name": "hotelId",
              "description": "The unique identifier of the hotel."
            }
          ]
        }
      },
      {
        "path": "/hotels/{hotelId}/rooms/{roomId}",
        "definition": {
          "entityName": "Room",
          "schema": {
            "$ref": "#/backend/entities/Room"
          },
          "description": "Stores room information for each hotel. Used to show the available rooms of each hotel.",
          "params": [
            {
              "name": "hotelId",
              "description": "The unique identifier of the hotel."
            },
            {
              "name": "roomId",
              "description": "The unique identifier of the room."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/bookings/{bookingId}",
        "definition": {
          "entityName": "Booking",
          "schema": {
            "$ref": "#/backend/entities/Booking"
          },
          "description": "Stores booking information for each user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "bookingId",
              "description": "The unique identifier of the booking."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "AdminRole",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Indicates that a user has admin privileges. Existence of the document grants admin access.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support a hotel booking application with user authentication, hotel browsing, booking management, and admin features, while prioritizing security and scalability. It adheres to the principles of Authorization Independence, Structural Segregation, Access Modeling, and Data Clarity.\n\n**Authorization Independence:**\n\n*   **Users:** User roles are stored directly in the `/users/{userId}` document. This avoids relying on custom claims, simplifying authentication logic.\n*   **Hotels:** Hotel data is stored in a top-level `/hotels` collection. There is no need for authorization checks based on parent documents.\n*   **Rooms:** Room data is stored in a subcollection `/hotels/{hotelId}/rooms/{roomId}`. This allows querying rooms by hotel.\n*   **Bookings:** Bookings are stored in the `/users/{userId}/bookings/{bookingId}` subcollection to make them independently accessible based on the user.\n\n**Structural Segregation:**\n\n*   User data (`/users/{userId}`) is segregated from hotel and booking data, ensuring different security requirements are isolated.\n*   Hotel data (`/hotels`) is separate from user-specific data.\n*   Bookings (`/users/{userId}/bookings/{bookingId}`) are segregated to allow user-specific access control.\n\n**Access Modeling:**\n\n*   **Private Data:** User profiles are stored under `/users/{userId}`, implementing Path-Based ownership.\n*   **Collaborative Data:** Although hotels are not collaborative in the traditional sense, admin access for hotel management can be implemented using a separate `/roles_admin/{uid}` collection. The existence of a document in this collection grants admin privileges.\n\n**QAPs (Rules are not Filters):**\n\n*   The structure allows secure `list` operations. For example:\n    *   Listing hotels: A rule can allow public read access to the `/hotels` collection.\n    *   Listing bookings: A rule can allow a user to only list bookings under their own `/users/{userId}/bookings` path.\n    *   Listing rooms: A rule can allow public read access to the `/hotels/{hotelId}/rooms` collection to list available rooms for hotel.\n\n**Invariants:**\n\n*   Ownership: Bookings are owned by the user via the `/users/{userId}/bookings` path.\n\nThe database is structured to facilitate a secure, scalable, and debuggable system, aligning with the defined design principles and strategy mandates."
  }
}