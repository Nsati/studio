
{
  "entities": {
    "City": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "City",
      "type": "object",
      "description": "Represents a city in Uttarakhand available for hotel bookings.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the city, usually a slug."
        },
        "name": {
          "type": "string",
          "description": "The name of the city."
        },
        "image": {
          "type": "string",
          "description": "An identifier for the placeholder image for the city."
        }
      },
      "required": [
        "id",
        "name",
        "image"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Uttarakhand Getaways application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The user's role within the application (e.g., 'user', 'admin')."
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "role"
      ]
    },
    "Hotel": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Hotel",
      "type": "object",
      "description": "Represents a hotel located in Uttarakhand.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the hotel entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the hotel."
        },
        "city": {
          "type": "string",
          "description": "The city in Uttarakhand where the hotel is located."
        },
        "description": {
          "type": "string",
          "description": "A description of the hotel."
        },
        "images": {
          "type": "array",
          "description": "An array of URLs pointing to images of the hotel.",
          "items": {
            "type": "string"
          }
        },
        "amenities": {
          "type": "array",
          "description": "An array of amenities offered by the hotel.",
          "items": {
            "type": "string"
          }
        },
        "rating": {
          "type": "number",
          "description": "The rating of the hotel (e.g., out of 5)."
        }
      },
      "required": [
        "id",
        "name",
        "city",
        "description",
        "images",
        "amenities",
        "rating"
      ]
    },
    "Room": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Room",
      "type": "object",
      "description": "Represents a room within a hotel.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the room entity."
        },
        "hotelId": {
          "type": "string",
          "description": "Reference to Hotel. (Relationship: Hotel 1:N Room)"
        },
        "type": {
          "type": "string",
          "description": "The type of room (e.g., 'Deluxe', 'Suite')."
        },
        "price": {
          "type": "number",
          "description": "The price per night for the room."
        },
        "capacity": {
          "type": "number",
          "description": "The maximum capacity of the room (number of guests)."
        },
        "totalRooms": {
          "type": "number",
          "description": "The total number of rooms of this type in the hotel."
        }
      },
      "required": [
        "id",
        "hotelId",
        "type",
        "price",
        "capacity",
        "totalRooms"
      ]
    },
    "Booking": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Booking",
      "type": "object",
      "description": "Represents a booking made by a user for a room at a hotel.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the booking entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Booking)"
        },
        "roomId": {
          "type": "string",
          "description": "Reference to Room. (Relationship: Room 1:N Booking)"
        },
        "checkIn": {
          "type": "string",
          "description": "The check-in date for the booking.",
          "format": "date-time"
        },
        "checkOut": {
          "type": "string",
          "description": "The check-out date for the booking.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The status of the booking (e.g., 'locked', 'confirmed', 'cancelled')."
        },
        "expiresAt": {
          "type": "string",
          "description": "The expiration date and time for the booking (used for 'locked' status).",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "roomId",
        "checkIn",
        "checkOut",
        "status",
        "expiresAt"
      ]
    },
    "TourPackage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TourPackage",
      "type": "object",
      "description": "Represents a tour package available in Uttarakhand.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the tour package, usually a slug."
        },
        "title": {
          "type": "string",
          "description": "The title of the tour package."
        },
        "duration": {
          "type": "string",
          "description": "The duration of the tour (e.g., '6 Nights / 7 Days')."
        },
        "destinations": {
          "type": "array",
          "description": "An array of destination names covered in the tour.",
          "items": {
            "type": "string"
          }
        },
        "price": {
          "type": "number",
          "description": "The starting price for the tour package."
        },
        "image": {
          "type": "string",
          "description": "An identifier for the placeholder image for the tour package."
        },
        "description": {
          "type": "string",
          "description": "A short description of the tour package."
        }
      },
      "required": [
        "id",
        "title",
        "duration",
        "destinations",
        "price",
        "image",
        "description"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Uses path-based ownership for private data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/cities/{cityId}",
        "definition": {
          "entityName": "City",
          "schema": {
            "$ref": "#/backend/entities/City"
          },
          "description": "Stores the list of cities available for booking.",
          "params": [
            {
              "name": "cityId",
              "description": "The unique identifier of the city."
            }
          ]
        }
      },
      {
        "path": "/hotels/{hotelId}",
        "definition": {
          "entityName": "Hotel",
          "schema": {
            "$ref": "#/backend/entities/Hotel"
          },
          "description": "Stores hotel details.",
          "params": [
            {
              "name": "hotelId",
              "description": "The unique identifier of the hotel."
            }
          ]
        }
      },
      {
        "path": "/hotels/{hotelId}/rooms/{roomId}",
        "definition": {
          "entityName": "Room",
          "schema": {
            "$ref": "#/backend/entities/Room"
          },
          "description": "Stores room details for each hotel. Includes denormalized 'hotelId' for authorization independence.",
          "params": [
            {
              "name": "hotelId",
              "description": "The unique identifier of the hotel."
            },
            {
              "name": "roomId",
              "description": "The unique identifier of the room."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/bookings/{bookingId}",
        "definition": {
          "entityName": "Booking",
          "schema": {
            "$ref": "#/backend/entities/Booking"
          },
          "description": "Stores booking information for each user. Uses path-based ownership. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "bookingId",
              "description": "The unique identifier of the booking."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "Role",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Indicates admin role. Existence of document grants admin privileges. Uses existence over content.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user (admin)."
            }
          ]
        }
      },
      {
        "path": "/tourPackages/{packageId}",
        "definition": {
          "entityName": "TourPackage",
          "schema": {
            "$ref": "#/backend/entities/TourPackage"
          },
          "description": "Stores tour package details.",
          "params": [
            {
              "name": "packageId",
              "description": "The unique identifier of the tour package."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to optimize for security, scalability, and real-time updates in the Uttarakhand Getaways hotel booking application. It follows the core design principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. Authorization Independence is achieved through denormalization, specifically by including relevant authorization data (like hotelId) in subcollections (like rooms and bookings). This avoids the need for `get()` calls in security rules. Structural Segregation is enforced by maintaining distinct collections for users, hotels, rooms, and bookings, each with homogeneous security requirements. Access Modeling leverages path-based ownership for user-specific data (bookings) and continues the hierarchy for nested entities. A membership map (`members`) would be used for collaborative entities, though it's not directly applicable in this scenario. Global roles (DBAC) are implemented using dedicated collections for admin users (`roles_admin/{uid}`). QAPs are supported by the segregated structure. Listing hotels or rooms does not require filtering based on user roles; separate collections ensure the rules are not used as filters. Explicit State Modeling uses the `status` field in bookings to clearly represent the booking state (locked, confirmed, cancelled)."
  }
}
